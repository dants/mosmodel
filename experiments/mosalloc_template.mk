MODULE_NAME := TEMPLATE_ARG1/configurationTEMPLATE_ARG2
SUBMODULES := 

EXPERIMENT_DIRS := $(addprefix $(MODULE_NAME)/,$(INTERESTING_BENCHMARKS))

$(MODULE_NAME): $(EXPERIMENT_DIRS)

.PHONY: $(EXPERIMENT_DIRS)
$(EXPERIMENT_DIRS): EXPERIMENT_ROOT_DIR := $(ROOT_DIR)/$(MODULE_NAME)
$(EXPERIMENT_DIRS): CONFIGURATION_NUM := TEMPLATE_ARG2
$(EXPERIMENT_DIRS): $(MOSALLOC_TOOL)

$(EXPERIMENT_DIRS): $(MODULE_NAME)/%: TEMPLATE_ARG1/%/configurations.txt | experiments-prerequisites
	cd $(EXPERIMENT_ROOT_DIR)
	ARGS_FOR_TOOL="$(shell head -$(CONFIGURATION_NUM) $< | tail -1) \
				  --library $(MOSALLOC_TOOL)"
	$(RUN_BENCHMARK_SCRIPT) $* --repeats $(NUM_OF_REPEATS) --submit_command \
		"$(MEASURE_GENERAL_METRICS) $(SET_CPU_MEMORY_AFFINITY) $(BOUND_MEMORY_NODE) \
		$(RUN_MOSALLOC_TOOL) $$ARGS_FOR_TOOL"

BIG_MEMORY_EXPERIMENT_DIRS := $(addprefix $(MODULE_NAME)/,$(BIG_MEMORY_BENCHMARKS))
$(BIG_MEMORY_EXPERIMENT_DIRS): | reserve-max-1gb-pages

CLEAN_TARGETS := $(addsuffix /clean,$(EXPERIMENT_DIRS))
$(CLEAN_TARGETS): %/clean: %/delete
$(MODULE_NAME)/clean: $(CLEAN_TARGETS)

