MODULE_NAME := experiments/tlb_simulation
SUBMODULES := 

include $(ROOT_DIR)/common.mk

TLB_SIMULATION_EXPERIMENT_ROOT := $(ROOT_DIR)/$(MODULE_NAME)
TLB_SIMULATION_WORKLOAD := my_gups/1GB
TLB_SIMULATION_RAW_DATA := $(TLB_SIMULATION_EXPERIMENT_ROOT)/$(PINTOOL_OUTPUT)

$(MODULE_NAME): $(TLB_SIMULATION_RAW_DATA)

$(TLB_SIMULATION_RAW_DATA): $(PINTOOL) $(MOSALLOC_TOOL) \
	| benchmarks/$(TLB_SIMULATION_WORKLOAD)
	cd $(TLB_SIMULATION_EXPERIMENT_ROOT)
	export HPC_VERBOSE_LEVEL=1
	$(PIN_RUN_COMMAND) -t $< -- $(RUN_BENCHMARK) $(TLB_SIMULATION_WORKLOAD)\
		--submit_command "$(GENERAL_METRICS_COMMAND) $(RUN_MOSALLOC_TOOL) \
		-fps 1GB -bps 1GB -aps 2GB -l $(MOSALLOC_TOOL) --debug --analyze"

$(MODULE_NAME)/clean:
	rm -rf $(TLB_SIMULATION_EXPERIMENT_ROOT)/$(TLB_SIMULATION_WORKLOAD)

