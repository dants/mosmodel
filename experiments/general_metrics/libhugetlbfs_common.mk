EXPERIMENT_DIRS := $(addprefix $(MODULE_NAME)/,$(INTERESTING_BENCHMARKS))

$(MODULE_NAME): $(EXPERIMENT_DIRS)

.PHONY: $(EXPERIMENT_DIRS)
$(EXPERIMENT_DIRS): EXPERIMENT_ROOT_DIR := $(ROOT_DIR)/$(MODULE_NAME)

$(EXPERIMENT_DIRS): $(MODULE_NAME)/%: | experiments-prerequisites
	cd $(EXPERIMENT_ROOT_DIR)
	$(RUN_BENCHMARK_SCRIPT) $* --repeats $(NUM_OF_REPEATS) --submit_command \
		     "$(MEASURE_GENERAL_METRICS) $(SET_CPU_MEMORY_AFFINITY) $(BOUND_MEMORY_NODE) \
			 $(RUN_LIBHUGETLBFS_TOOL) --library=$(LIBHUGETLBFS_LIB) \
			 --large_pages=$(REQUESTED_LARGE_PAGES) --huge_pages=$(REQUESTED_HUGE_PAGES) \
			 --morecore=$(HUGETLB_MORECORE) --set_thp=$(SET_THP) --reserve_hugepages=$(RESERVE_HUGE_PAGES)"

CLEAN_TARGETS := $(addsuffix /clean,$(EXPERIMENT_DIRS))
$(CLEAN_TARGETS): %/clean: %/delete
$(MODULE_NAME)/clean: $(CLEAN_TARGETS)


