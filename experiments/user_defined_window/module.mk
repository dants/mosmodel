MODULE_NAME := experiments/user_defined_window
USER_DEFINED_WINDOW_MODULE_NAME := $(MODULE_NAME)

NUM_OF_CONFIGURATIONS := 9
$(MODULE_NAME)/%: NUM_OF_CONFIGURATIONS := $(NUM_OF_CONFIGURATIONS)
USER_DEFINED_WINDOW_CONFIGURATIONS := \
	$(call configuration_array,$(NUM_OF_CONFIGURATIONS))
SUBMODULES := $(addprefix $(MODULE_NAME)/,$(USER_DEFINED_WINDOW_CONFIGURATIONS))

USER_DEFINED_WINDOW_NUM_OF_REPEATS := 4
$(MODULE_NAME)/%: NUM_OF_REPEATS := $(USER_DEFINED_WINDOW_NUM_OF_REPEATS)

CONFIGURATION_MAKEFILES := $(addsuffix /module.mk,$(SUBMODULES))
$(CONFIGURATION_MAKEFILES): $(MODULE_NAME)/configuration%/module.mk: \
	$(MOSALLOC_TEMPLATE)
	mkdir -p $(dir $@)
	cp -rf $< $@
	sed -i 's,TEMPLATE_ARG1,$(USER_DEFINED_WINDOW_MODULE_NAME),g' $@
	sed -i 's,TEMPLATE_ARG2,$*,g' $@

PER_BENCHMARK_TARGETS := $(addprefix $(MODULE_NAME)/,$(INTERESTING_BENCHMARKS))
$(PER_BENCHMARK_TARGETS): $(MODULE_NAME)/%: $(addsuffix /%,$(SUBMODULES))
	echo "Finished running all configurations of benchmark $*: $^"

USER_DEFINED_CONFIGURATION_FILES := $(addprefix $(MODULE_NAME)/,$(INTERESTING_BENCHMARKS))
USER_DEFINED_CONFIGURATION_FILES := $(addsuffix /configurations.txt,$(USER_DEFINED_CONFIGURATION_FILES))
USER_DEFINED_CONFIGURATION_OUTPUT_DIR := $(MODULE_NAME)

DELETE_TARGETS := $(addsuffix /delete,$(CONFIGURATION_FILES) \
	$(CONFIGURATION_MAKEFILES))
$(MODULE_NAME)/clean: $(DELETE_TARGETS)

include $(ROOT_DIR)/common.mk

